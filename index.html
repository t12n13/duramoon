<!doctype html>
<!--
Version 1.0.0 : 初期公開（フォロー機能のみ）
Version 2.10  : プロフィール「一言」モーダル / タブ / ギャラリー準備
Version 2.16  : 公式カードの枠線を黒に
Version 2.18  : 背景画像を固定で適用（透過なし）、カード影
Version 2.19  : プロフィールモーダルに「✖」ボタン
Version 2.22  : チェキタグまとめ（改行コピー）
Version 2.23  : 2.22に落ちた機能を統合復元（モーダル・一括オープン・指定メンバーコピー・DeepLink）
-->
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dura-Moon Fan Hub｜公式まとめ</title>
<style>
  :root{ --fg:#111; --muted:#6b7280; --line:#e5e7eb }
  *{box-sizing:border-box}
  body{
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    margin:0; color:var(--fg);
    background: url('image/bg.png') no-repeat center center fixed;
    background-size: cover;
  }
  .wrap{max-width:1000px; margin:0 auto; padding:20px}
  .version{position:fixed; top:6px; left:10px; font-size:.8rem; color:#cbd5e1; z-index:1000}
  header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin:6px 0 14px}
  header h1{font-size:1.28rem; margin:0; color:#f1f5f9; text-shadow:0 1px 2px rgba(0,0,0,.35)}
  nav{display:flex; gap:10px; flex-wrap:wrap}
  nav button{padding:6px 12px; border:1px solid var(--line); border-radius:10px; background:#fff; cursor:pointer}
  nav button.active{background:#111; color:#fff; border-color:#111}
  .tools{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
  .tools label{color:#e2e8f0}
  .tools select,.tools button{padding:6px 10px; border:1px solid var(--line); border-radius:8px; background:#fff; cursor:pointer}
  /* グリッド */
  .grid{display:grid; gap:16px}
  @media(min-width:700px){ .grid{ grid-template-columns: repeat(2,minmax(0,1fr)); } }
  @media(min-width:1024px){ .grid{ grid-template-columns: repeat(3,minmax(0,1fr)); } }
  /* カード */
  .card{
    background:#fff; border:3px solid var(--accent,var(--line)); border-radius:16px; padding:14px;
    box-shadow:0 6px 18px rgba(0,0,0,.18);
  }
  .bar{display:flex; align-items:center; justify-content:space-between; margin-bottom:8px}
  .tag{font-size:.8rem; color:#64748b}
  .openall{font-size:.9rem; color:#0369a1; text-decoration:underline; background:none; border:none; padding:4px 2px; cursor:pointer}
  .head{display:flex; align-items:center; gap:12px; margin-bottom:10px; cursor:pointer}
  .avatar{width:74px; height:74px; border-radius:50%; border:2px solid var(--accent,var(--line)); object-fit:cover; background:#e5e7eb}
  .names{display:flex; flex-direction:column}
  .names .display{font-weight:700}
  .names .handle{font-size:.9rem; color:#6b7280}
  .names .tagline{font-size:.86rem; color:#64748b; margin-top:2px}
  .btns{display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:8px}
  .btn{display:flex; align-items:center; justify-content:center; gap:10px; padding:11px 10px; border-radius:12px; border:1px solid var(--line); background:#fff; font-weight:600; color:#111; text-decoration:none}
  .btn svg{width:18px; height:18px}
  .btn:hover{filter:brightness(0.98)}
  .cheki{font-size:.86rem; margin-top:6px}
  .cheki a{color:#0369a1; text-decoration:underline}
  .cheki button{margin-left:6px}
  footer{margin-top:20px; font-size:.86rem; color:#e2e8f0}

  /* タグまとめ */
  #tagsTab{background:rgba(255,255,255,.7); border:1px solid var(--line); border-radius:12px; padding:12px}
  .tag-list{display:grid; gap:8px}
  .tag-item{background:#fff; padding:10px; border:1px solid var(--line); border-radius:8px; display:flex; justify-content:space-between; align-items:center}
  .tools-row{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px}
  .tools-row button{padding:6px 10px; border:1px solid var(--line); border-radius:8px; background:#fff; cursor:pointer}

  /* モーダル */
  .overlay{position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; z-index:950}
  .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; padding:16px; z-index:999}
  .modal-card{max-width:720px; width:100%; background:#fff; border:3px solid var(--accent,var(--line)); border-radius:16px; padding:18px; position:relative}
  .modal-head{display:flex; align-items:center; gap:14px; margin-bottom:8px}
  .modal-avatar{width:108px; height:108px; border-radius:50%; object-fit:cover; border:3px solid var(--accent,var(--line))}
  .modal-title{font-size:1.25rem; font-weight:700}
  .modal-tagline{color:#64748b; margin-top:4px}
  .modal-actions{display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:8px; margin-top:12px}
  .closex{position:absolute; top:10px; right:14px; background:none; border:none; font-size:1.4rem; cursor:pointer}

  /* トースト */
  .toast{position:fixed; bottom:20px; right:20px; background:#111; color:#fff; padding:8px 12px; border-radius:8px; opacity:0.9; z-index:2000}
</style>
</head>
<body>
  <div class="version">Version 2.23</div>
  <div class="wrap">
    <header>
      <div>
        <h1>Dura-Moon 公式SNSまとめ</h1>
        <nav>
          <button id="tab-follow" class="active">SNSまとめ</button>
          <button id="tab-tags">チェキタグまとめ</button>
        </nav>
      </div>
      <div class="tools">
        <label for="chekiPicker">🔖 指定メンバーのチェキタグ：</label>
        <select id="chekiPicker"></select>
        <button id="chekiCopy">コピー</button>
      </div>
    </header>

    <!-- SNSまとめ -->
    <div id="followTab" class="grid"></div>

    <!-- チェキタグまとめ -->
    <div id="tagsTab" style="display:none">
      <div class="tools-row">
        <button id="selectAll">全選択</button>
        <button id="selectNone">選択解除</button>
        <button id="copySelected">選択タグを改行でコピー</button>
        <button id="copyAll">全タグを改行でコピー</button>
      </div>
      <div class="tag-list" id="tagList"></div>
    </div>

    <footer>
      ※ 一部SNSは自動フォローを許可していないため、確認画面が表示されます。<br>
      ※ 「このメンバーのリンクを一括で開く」はブラウザのポップアップ制限に影響される場合があります。
    </footer>
  </div>

<script>
/* ===== データ ===== */
const MEMBERS = [
  { display:"ドゥラ・ムーン公式", aka:"公式", color:"#000000", avatar:"image/duramoon.jpg?v=2", cheki:"#ドゥラムーン", x:"Duramoon__info", ig:"duramoon__info", tiktok:"duramoon_idol" },
  { display:"御伽 望愛", aka:"おとぎ のあ", color:"#ec4899", avatar:"image/noa.jpg", tagline:"『約束の地で未来永劫の日々を』", cheki:"#見てるよのあち", x:"noa__dura", ig:"_1984180", tiktok:"n0q1_o14" },
  { display:"終宵 ねお", aka:"おしまい ねお", color:"#ef4444", avatar:"image/neo.jpg", tagline:"『狂うほど愛し合おう、この生き地獄で』", cheki:"#終宵ﾉ世界ﾃﾞ共依存", x:"neo__dura", ig:"ponkotsuneotaro_", tiktok:"ponkotsuneotaro" },
  { display:"琥珀 トワ", aka:"こはく とわ", color:"#f59e0b", avatar:"image/towa.jpg", tagline:"『貴方の世界に、永遠の夢毒をあげる♥』", cheki:"#永遠威艶狼卍會", x:"towa__dura", ig:"15milk01c", tiktok:"tow4_nyan" },
  { display:"死喰 ちる", aka:"しくい ちる", color:"#9ca3af", avatar:"image/chill.jpg", tagline:"『永遠に離さない、愛も憎しみも全部私のもの』", cheki:"#ちると堕ちる", x:"chill__dura", ig:"xx_nyqn2_xx", tiktok:"xx_nyan2_xx" },
  { display:"髏黯 メア", aka:"ろあん めあ", color:"#8b5cf6", avatar:"image/mea.jpg", tagline:"『貴方の瞳の中で踊らせて』", cheki:"#メアの瞳の中", x:"mea__dura", ig:"roamea_", tiktok:"roamea_" },
];

/* ===== ユーティリティ ===== */
const isIOS = /iP(hone|od|ad)/.test(navigator.userAgent);
const isAndroid = /Android/.test(navigator.userAgent);
function openWithFallback(appUrl, webUrl){
  if(!(isIOS || isAndroid)){ window.open(webUrl, '_blank'); return; }
  const t=Date.now(); window.location.href = appUrl;
  setTimeout(()=>{ if(Date.now()-t<1600){ window.location.href = webUrl; } },1200);
}
function linksetFor(m){
  const arr=[];
  if(m.x){ arr.push({key:'x',label:'X',href:`https://twitter.com/intent/follow?screen_name=${encodeURIComponent(m.x)}`,open:()=>window.open(`https://twitter.com/intent/follow?screen_name=${encodeURIComponent(m.x)}`,'_blank')}); }
  if(m.ig){ const app=`instagram://user?username=${m.ig}`, web=`https://www.instagram.com/${m.ig}/`; arr.push({key:'ig',label:'Instagram',href:'#',open:()=>openWithFallback(app,web)}); }
  if(m.tiktok){ const app=`snssdk1128://user/profile/@${m.tiktok}`, web=`https://www.tiktok.com/@${m.tiktok}`; arr.push({key:'tt',label:'TikTok',href:'#',open:()=>openWithFallback(app,web)}); }
  return arr;
}
function icon(key){
  const svgs={
    x:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4l16 16M20 4L4 20"/></svg>',
    ig:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><circle cx="17.5" cy="6.5" r="1.5"/></svg>',
    tt:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3v6a5 5 0 1 1-5 5"/><path d="M15 3c1.5 2 3.5 3 6 3"/></svg>'
  }; return svgs[key]||'';
}
function showToast(msg){
  const t=document.createElement('div'); t.className='toast'; t.textContent=msg;
  document.body.appendChild(t); setTimeout(()=>t.remove(),3000);
}

/* ===== SNSまとめ：カード描画 ===== */
function renderFollow(){
  const grid=document.getElementById('followTab'); grid.innerHTML='';
  MEMBERS.forEach((m,idx)=>{
    const card=document.createElement('div'); card.className='card'; card.style.setProperty('--accent',m.color);
    /* 上バー */
    const bar=document.createElement('div'); bar.className='bar';
    const tag=document.createElement('div'); tag.className='tag'; tag.textContent=`#${String(idx+1).padStart(2,'0')}`;
    const openall=document.createElement('button'); openall.className='openall'; openall.textContent='このメンバーのリンクを一括で開く';
    const links=linksetFor(m);
    openall.onclick=()=>{ links.forEach(lnk=>{ if(lnk.key==='ig'){window.open(`https://www.instagram.com/${m.ig}/`,'_blank');} else if(lnk.key==='tt'){window.open(`https://www.tiktok.com/@${m.tiktok}`,'_blank');} else {window.open(lnk.href,'_blank');} }); };
    bar.appendChild(tag); bar.appendChild(openall);

    /* ヘッダ */
    const head=document.createElement('div'); head.className='head'; head.onclick=()=>openProfile(m);
    const av=document.createElement('img'); av.className='avatar'; av.src=m.avatar; av.alt=m.display;
    const names=document.createElement('div'); names.className='names';
    names.innerHTML=`<div class="display">${m.display}</div><div class="handle">${m.aka?('@'+m.aka):''}</div>${m.tagline?`<div class="tagline">${m.tagline}</div>`:''}`;
    head.appendChild(av); head.appendChild(names);

    /* ボタン */
    const btns=document.createElement('div'); btns.className='btns';
    links.forEach(lnk=>{ const a=document.createElement('a'); a.className='btn'; a.href=lnk.href; a.onclick=(e)=>{e.preventDefault(); lnk.open(e);}; a.innerHTML=icon(lnk.key)+`<span>${lnk.label}</span>`; btns.appendChild(a); });

    /* チェキ */
    const cheki=document.createElement('div'); cheki.className='cheki';
    if(m.cheki){
      const a=document.createElement('a'); a.href=`https://x.com/hashtag/${encodeURIComponent(m.cheki.replace(/^#/,''))}`; a.textContent=m.cheki; a.target='_blank';
      const copy=document.createElement('button'); copy.textContent='コピー'; copy.onclick=()=>{navigator.clipboard.writeText(m.cheki).then(()=>showToast(`${m.cheki} をコピーしました`));};
      cheki.appendChild(a); cheki.appendChild(copy);
    }

    card.appendChild(bar); card.appendChild(head); card.appendChild(btns); card.appendChild(cheki);
    grid.appendChild(card);
  });
}

/* ===== プロフィールモーダル ===== */
function openProfile(m){
  let overlay=document.querySelector('.overlay'); let modal=document.querySelector('.modal');
  if(!overlay){ overlay=document.createElement('div'); overlay.className='overlay'; document.body.appendChild(overlay); }
  if(!modal){ modal=document.createElement('div'); modal.className='modal'; document.body.appendChild(modal); }
  modal.innerHTML='';

  const card=document.createElement('div'); card.className='modal-card'; card.style.setProperty('--accent',m.color);
  const close=document.createElement('button'); close.className='closex'; close.innerHTML='✖'; close.onclick=closeModal;

  const head=document.createElement('div'); head.className='modal-head';
  const img=document.createElement('img'); img.className='modal-avatar'; img.src=m.avatar; img.alt=m.display;
  const info=document.createElement('div');
  const ttl=document.createElement('div'); ttl.className='modal-title'; ttl.textContent=m.display;
  const aka=document.createElement('div'); aka.style.color='#64748b'; aka.textContent=m.aka?`@${m.aka}`:'';
  const tag=document.createElement('div'); tag.className='modal-tagline'; tag.textContent=m.tagline||'';
  info.appendChild(ttl); info.appendChild(aka); if(m.tagline){ info.appendChild(tag); }
  head.appendChild(img); head.appendChild(info);

  const actions=document.createElement('div'); actions.className='modal-actions';
  linksetFor(m).forEach(lnk=>{ const a=document.createElement('a'); a.className='btn'; a.href=lnk.href; a.onclick=(e)=>{e.preventDefault(); lnk.open(e);}; a.innerHTML=icon(lnk.key)+`<span>${lnk.label}</span>`; actions.appendChild(a); });

  if(m.cheki){
    const ck=document.createElement('div'); ck.style.marginTop='8px'; ck.style.fontSize='.95rem';
    const a=document.createElement('a'); a.href=`https://x.com/hashtag/${encodeURIComponent(m.cheki.replace(/^#/,''))}`; a.textContent=`🔖 ${m.cheki}`; a.target='_blank';
    const copy=document.createElement('button'); copy.textContent='コピー'; copy.style.marginLeft='8px';
    copy.onclick=()=>{navigator.clipboard.writeText(m.cheki).then(()=>showToast(`${m.cheki} をコピーしました`));};
    ck.appendChild(a); ck.appendChild(copy); info.appendChild(ck);
  }

  card.appendChild(close); card.appendChild(head); card.appendChild(actions); modal.appendChild(card);
  overlay.style.display='block'; modal.style.display='flex'; overlay.onclick=closeModal; document.addEventListener('keydown',esc);
  function esc(ev){ if(ev.key==='Escape') closeModal(); }
  function closeModal(){ overlay.style.display='none'; modal.style.display='none'; document.removeEventListener('keydown',esc); }
}

/* ===== タグまとめ ===== */
function renderTags(){
  const list=document.getElementById('tagList'); list.innerHTML='';
  MEMBERS.forEach((m,idx)=>{
    if(!m.cheki) return;
    const item=document.createElement('div'); item.className='tag-item';
    item.innerHTML=`<label><input type="checkbox" value="${idx}"> ${m.display} ${m.cheki}</label><button>コピー</button>`;
    item.querySelector('button').onclick=()=>{navigator.clipboard.writeText(m.cheki).then(()=>showToast(`${m.cheki} をコピーしました`));};
    list.appendChild(item);
  });
}
document.getElementById('selectAll').onclick=()=>{ document.querySelectorAll('#tagList input[type="checkbox"]').forEach(cb=>cb.checked=true); };
document.getElementById('selectNone').onclick=()=>{ document.querySelectorAll('#tagList input[type="checkbox"]').forEach(cb=>cb.checked=false); };
document.getElementById('copySelected').onclick=()=>{
  const picked=[...document.querySelectorAll('#tagList input:checked')];
  if(!picked.length){ showToast('タグが選択されていません'); return; }
  const text=picked.map(cb=>MEMBERS[cb.value].cheki).join('\n');
  navigator.clipboard.writeText(text).then(()=>showToast('選択タグを改行区切りでコピーしました'));
};
document.getElementById('copyAll').onclick=()=>{
  const text=MEMBERS.map(m=>m.cheki).filter(Boolean).join('\n');
  navigator.clipboard.writeText(text).then(()=>showToast('全タグを改行区切りでコピーしました'));
};

/* ===== 指定メンバーのチェキタグ（ヘッダー） ===== */
function buildChekiTool(){
  const picker=document.getElementById('chekiPicker'); picker.innerHTML='';
  MEMBERS.forEach((m,i)=>{ if(!m.cheki) return; const o=document.createElement('option'); o.value=i; o.textContent=`${m.display}（${m.cheki}）`; picker.appendChild(o); });
  document.getElementById('chekiCopy').onclick=()=>{
    const m = MEMBERS[picker.value|0]; if(!m?.cheki) return;
    navigator.clipboard.writeText(m.cheki).then(()=>showToast(`${m.cheki} をコピーしました`));
  };
}
function handleChekiParam(){
  const p=new URLSearchParams(location.search); const q=p.get('cheki'); if(!q) return;
  const norm=s=>String(s).toLowerCase().replace(/\s+/g,'');
  const idx=MEMBERS.findIndex(m=>[m.display,m.aka,m.x,m.ig,m.tiktok].filter(Boolean).some(v=>norm(v).includes(norm(q))));
  if(idx>=0){ const picker=document.getElementById('chekiPicker'); picker.value=String(idx); document.getElementById('chekiCopy').click(); }
}

/* ===== タブ切替 ===== */
document.getElementById('tab-follow').onclick=()=>switchTab('follow');
document.getElementById('tab-tags').onclick=()=>switchTab('tags');
function switchTab(tab){
  document.getElementById('followTab').style.display = (tab==='follow')?'grid':'none';
  document.getElementById('tagsTab').style.display   = (tab==='tags')?'block':'none';
  document.getElementById('tab-follow').classList.toggle('active',tab==='follow');
  document.getElementById('tab-tags').classList.toggle('active',tab==='tags');
}

/* ===== 初期化 ===== */
document.addEventListener('DOMContentLoaded', ()=>{
  renderFollow();
  renderTags();
  buildChekiTool();
  handleChekiParam();
});
</script>
</body>
</html>
